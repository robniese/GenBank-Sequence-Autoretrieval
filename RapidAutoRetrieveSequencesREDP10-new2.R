#This script is designed to automatically download FASTA sequence data for a given gene for an entire list of taxa. 
#Your list (a vector) could also be replaced with CSV file (read it in, specify columns to use). The script queries
#the online database, however, and can take a long time for larger lists of taxa.


#be sure to install these packages the first time you run this script
#install.packages ("rentrez")
#install.packages("seqinr")

#set where you want to save and edit files from
setwd("C:/Users/dbsadmin/Google Drive/R_Files/Pigeon Phylogeny/texts")

#make a blank text file in this folder with the name that is specified below. Currently it is "TreronFetchResults.txt"

#load packages; only once
library (rentrez)
library (ape)
library ("seqinr")
sessionInfo() #double check packages are loaded

##I pasted this list of species from Wikipedia into a text tile, then cleaned it up, added punctuation, and copy-pasted it here. 
##Should work up to 500 spp at a time (slowly).
####Note: to search a single species, see tutorial at ??rentrez

# (original names; see below for updated lists)
RedP10 <- c("Alectroenas madagascariensis","Alectroenas pulcherrima","Alopecoenas beccarii","Alopecoenas salamonis","Aplopelia larvata","Caloenas maculata","Caloenas nicobarica","Chalcophaps indica","Chalcophaps stephani","Claravis geoffroyi","Claravis mondetoura","Claravis pretiosa","Columba arquatrix","Columba bollii","Columba elphinstonii","Columba guinea","Columba hodgsonii","Columba iriditorques","Columba janthina janthina","Columba janthina nitens","Columba janthina","Columba jouyi","Columba junoniae","Columba leucomela","Columba leuconota","Columba livia","Columba oenas","Columba palumbus azorica","Columba palumbus palumbus","Columba palumbus","Columba pulchricollis","Columba rupestris","Columba subvinacea","Columba trocaz","Columba vitiensis","Columbina buckleyi","Columbina cruziana","Columbina inca","Columbina minuta","Columbina passerina","Columbina picui","Columbina talpacoti","Didunculus strigirostris","Drepanoptila holosericea","Ducula aenea paulina","Ducula aenea","Ducula aurorae","Ducula badia","Ducula bakeri","Ducula basilica","Ducula bicolor","Ducula brenchleyi","Ducula chalconota","Ducula finschii","Ducula forsteni","Ducula galeata","Ducula goliath","Ducula latrans","Ducula luctuosa","Ducula melanochroa","Ducula mullerii","Ducula myristicivora","Ducula oceanica","Ducula pacifica","Ducula pinon","Ducula pistrinaria","Ducula rubricera","Ducula rufigaster","Ducula zoeae","Ectopistes migratorius","Gallicolumba canifrons","Gallicolumba crinigera","Gallicolumba erythroptera","Gallicolumba hoedtii","Gallicolumba jobiensis","Gallicolumba keayi","Gallicolumba kubaryi","Gallicolumba luzonica","Gallicolumba platenae","Gallicolumba rubescens","Gallicolumba rufigula","Gallicolumba sanctaecrucis","Gallicolumba stairi","Gallicolumba tristigmata","Gallicolumba xanthonura","Geopelia cuneata","Geopelia humeralis","Geopelia placida","Geopelia striata","Geophaps plumifera","Geophaps scripta","Geophaps smithii","Geotrygon chrysia","Geotrygon montana","Geotrygon purpurata","Geotrygon saphirina","Geotrygon veraguensis","Geotrygon versicolor","Geotrygon violacea","Goura cristata minor","Goura cristata","Goura scheepmakeri","Goura sclaterii","Goura victoria beccarii","Goura victoria","Gymnophaps albertisii","Hemiphaga chathamensis","Hemiphaga novaeseelandiae novaeseelandiae","Hemiphaga novaeseelandiae spadicea","Hemiphaga novaeseelandiae","Henicophaps albifrons","Leptotila cassini cassini","Leptotila cassini cerviniventris","Leptotila cassini","Leptotila jamaicensis","Leptotila megalura","Leptotila plumbeiceps","Leptotila rufaxilla rufaxilla","Leptotila rufaxilla","Leptotila verreauxi angelica","Leptotila verreauxi chalcauchenia","Leptotila verreauxi decipiens","Leptotila verreauxi decolor","Leptotila verreauxi fulviventris","Leptotila verreauxi","Leucosarcia melanoleuca","Lopholaimus antarcticus","Macropygia amboinensis","Macropygia mackinlayi","Macropygia nigrirostris","Macropygia phasianella","Macropygia ruficeps","Macropygia tenuirostris","Macropygia unchall","Metriopelia aymara","Metriopelia ceciliae","Metriopelia melanoptera","Metriopelia morenoi","Nesoenas mayeri","Ocyphaps lophotes","Oena capensis","Otidiphaps nobilis","Patagioenas araucana","Patagioenas cayennensis","Patagioenas fasciata monilis","Patagioenas fasciata","Patagioenas flavirostris","Patagioenas inornata inornata","Patagioenas inornata wetmorei","Patagioenas inornata","Patagioenas leucocephala","Patagioenas maculosa","Patagioenas nigrirostris","Patagioenas oenops","Patagioenas picazuro","Patagioenas plumbea","Patagioenas speciosa","Patagioenas squamosa","Patagioenas subvinacea","Petrophassa albipennis","Petrophassa plumifera","Petrophassa rufipennis","Phapitreron amethystinus","Phapitreron cinereiceps","Phapitreron leucotis brevirostris","Phapitreron leucotis leucotis","Phapitreron leucotis nigrorum","Phapitreron leucotis","Phaps chalcoptera","Phaps elegans","Phaps histrionica","Ptilinopus aurantiifrons","Ptilinopus bernsteinii","Ptilinopus chalcurus","Ptilinopus cinctus","Ptilinopus coralensis","Ptilinopus coronulatus coronulatus","Ptilinopus coronulatus","Ptilinopus dupetithouarsii dupetithouarsii","Ptilinopus dupetithouarsii viridior","Ptilinopus dupetithouarsii","Ptilinopus eugeniae","Ptilinopus greyii","Ptilinopus huttoni","Ptilinopus hyogastrus","Ptilinopus insularis","Ptilinopus iozonus","Ptilinopus jambu","Ptilinopus layardi","Ptilinopus leclancheri","Ptilinopus luteovirens","Ptilinopus magnificus","Ptilinopus marchei","Ptilinopus melanospilus","Ptilinopus mercierii tristrami","Ptilinopus mercierii","Ptilinopus merrilli","Ptilinopus monacha","Ptilinopus nainus","Ptilinopus occipitalis","Ptilinopus ornatus","Ptilinopus pelewensis","Ptilinopus perlatus","Ptilinopus perousii","Ptilinopus porphyraceus","Ptilinopus porphyreus","Ptilinopus pulchellus","Ptilinopus purpuratus chrysogaster","Ptilinopus purpuratus frater","Ptilinopus purpuratus purpuratus","Ptilinopus purpuratus","Ptilinopus rarotongensis goodwini","Ptilinopus rarotongensis rarotongensis","Ptilinopus rarotongensis","Ptilinopus regina","Ptilinopus richardsii","Ptilinopus rivoli","Ptilinopus roseicapilla","Ptilinopus solomonensis","Ptilinopus superbus","Ptilinopus tannensis","Ptilinopus victor","Ptilinopus viridis","Ptilinopus wallacii","Reinwardtoena browni","Reinwardtoena reinwardtii","Scardafella squammata","Streptopelia bitorquata","Streptopelia capicola","Streptopelia chinensis","Streptopelia decaocto decaocto","Streptopelia decaocto","Streptopelia decipiens","Streptopelia hypopyrrha","Streptopelia lugens","Streptopelia orientalis stimpsoni","Streptopelia orientalis","Streptopelia picturata","Streptopelia risoria","Streptopelia roseogrisea","Streptopelia semitorquata","Streptopelia senegalensis","Streptopelia tranquebarica","Streptopelia turtur turtur","Streptopelia turtur","Streptopelia vinacea","Treron apicauda","Treron australis","Treron bicinctus","Treron calvus","Treron curvirostra","Treron formosae","Treron phayrei","Treron phoenicopterus","Treron pompadora","Treron sieboldii","Treron sphenurus","Treron vernans","Treron waalia","Trugon terrestris","Turacoena manadensis","Turtur abyssinicus","Turtur afer","Turtur brehmeri","Turtur chalcospilos","Turtur tympanistria","Uropelia campestris","Zenaida asiatica","Zenaida auriculata","Zenaida aurita","Zenaida galapagoensis","Zenaida graysoni","Zenaida macroura","Zenaida meloda","Zentrygon albifacies","Zentrygon chiriquensis","Zentrygon costaricensis","Zentrygon frenata erythropareia","Zentrygon frenata frenata","Zentrygon frenata","Zentrygon goldmani","Zentrygon lawrencii")

#now, we'll conduct x number of searches for x number of species that you specified in TreronSpecies above.

cutoff = length(RedP10) #tells the script when to stop. Double-check that the last species in your list matches the last species in your text output later.

x = 0 #always start with x at 0

repeat {
  if (x > cutoff) {break}
  x = x+1
  repeat {
        
        RedP10Term = paste("("",RedP10[x], ""[Organism]) AND ",r12S, sep = "")   #defines a search term appended (pasted) onto your species name from the list above; for complete terms see tutorial at ??rentrez 
        RedP10Search <- entrez_search(db = "nuccore", #specify the database to use (nuccore is for nucleotide data; for a list of databases see the tutorial at ??rentrez)
                                     term = RedP10Term,
                                     retmax = 1) #specifies how many samples you want to keep (here I only want 4, not all 1126 that are available)
        
        if(x > cutoff) {break} 
        else if(length(RedP10Search$ids) == 0) #if there isn't data available for a species, the search will quit and will not complete your list above
                {NoData = paste(RedP10[x], "- no r12S data available", sep = " ")
                NoDataEntry = paste("> ", NoData, sep = "")
                write(NoDataEntry, "r12S Fetch Results New2.txt", sep="\n", append = TRUE)
                x = x+1
                }
        else {break}
          }                    #says "if no data is found, enter "no data found" then check the next species"
  if (x > cutoff) {break}      
  RedP10Seqs <- entrez_fetch(db="nuccore", id=RedP10Search$ids, rettype="fasta")
  write(RedP10Seqs, "r12S Fetch Results New2.txt", sep="\n", append = TRUE)
  }

#repeat for all genes of interest (change COI[Gene Name] in TreronTerm); don't forget to alter the sequence length range (SLEN variable)
#can also use generic search terms such as "AND fibrinogen" instead of "AND FBG[Gene Name]"
####also, note that entrez_db_searchable("nuccore") specifies 3 or 4-letter codes (e.g. [ORGN] instead of 
####[Organism], [GENE] instead of [Gene Name]). This might be affecting searches.

#complete list of names divided into two segments
#segment 1
RedP10 <- c("Alectroenas madagascariensis","Alectroenas pulcherrima","Alopecoenas beccarii","Alopecoenas salamonis","Aplopelia larvata","Caloenas nicobarica","Chalcophaps indica","Chalcophaps stephani","Claravis geoffroyi","Claravis mondetoura","Claravis pretiosa","Columba arquatrix","Columba bollii","Columba elphinstonii","Columba guinea","Columba hodgsonii","Columba iriditorques","Columba janthina","Columba jouyi","Columba junoniae","Columba leucomela","Columba leuconota","Columba livia","Columba oenas","Columba palumbus","Columba pulchricollis","Columba rupestris","Columba trocaz","Columba vitiensis","Columbina buckleyi","Columbina cruziana","Columbina inca","Columbina minuta","Columbina passerina","Columbina picui","Columbina talpacoti","Didunculus strigirostris","Drepanoptila holosericea","Ducula aenea","Ducula aurorae","Ducula badia","Ducula bakeri","Ducula basilica","Ducula bicolor","Ducula brenchleyi","Ducula chalconota","Ducula finschii","Ducula forsteni","Ducula galeata","Ducula goliath","Ducula latrans","Ducula luctuosa","Ducula melanochroa","Ducula mullerii","Ducula myristicivora","Ducula oceanica","Ducula pacifica","Ducula pinon","Ducula pistrinaria","Ducula rubricera","Ducula rufigaster","Ducula zoeae","Ectopistes migratorius","Gallicolumba canifrons","Gallicolumba crinigera","Gallicolumba erythroptera","Gallicolumba hoedtii","Gallicolumba jobiensis","Gallicolumba keayi","Gallicolumba kubaryi","Gallicolumba luzonica","Gallicolumba platenae","Gallicolumba rubescens","Gallicolumba rufigula","Gallicolumba sanctaecrucis","Gallicolumba stairi","Gallicolumba tristigmata","Gallicolumba xanthonura","Geopelia cuneata","Geopelia humeralis","Geopelia placida","Geopelia striata","Geophaps plumifera","Geophaps scripta","Geophaps smithii","Geotrygon chrysia","Geotrygon montana","Geotrygon purpurata","Geotrygon saphirina","Geotrygon veraguensis","Geotrygon versicolor","Geotrygon violacea","Goura cristata","Goura scheepmakeri","Goura sclaterii","Goura victoria","Gymnophaps albertisii","Hemiphaga novaeseelandiae")
#segment 2
RedP10 <- c("Henicophaps albifrons","Leptotila cassini","Leptotila jamaicensis","Leptotila megalura","Leptotila plumbeiceps","Leptotila rufaxilla","Leptotila verreauxi","Leucosarcia melanoleuca","Lopholaimus antarcticus","Macropygia amboinensis","Macropygia mackinlayi","Macropygia nigrirostris","Macropygia phasianella","Macropygia ruficeps","Macropygia tenuirostris","Macropygia unchall","Metriopelia aymara","Metriopelia ceciliae","Metriopelia melanoptera","Metriopelia morenoi","Nesoenas mayeri","Ocyphaps lophotes","Oena capensis","Otidiphaps nobilis","Patagioenas araucana","Patagioenas cayennensis","Patagioenas fasciata","Patagioenas flavirostris","Patagioenas inornata","Patagioenas leucocephala","Patagioenas maculosa","Patagioenas nigrirostris","Patagioenas oenops","Patagioenas picazuro","Patagioenas plumbea","Patagioenas speciosa","Patagioenas squamosa","Patagioenas subvinacea","Petrophassa albipennis","Petrophassa rufipennis","Phapitreron amethystinus","Phapitreron cinereiceps","Phapitreron leucotis","Phaps chalcoptera","Phaps elegans","Phaps histrionica","Ptilinopus aurantiifrons","Ptilinopus bernsteinii","Ptilinopus chalcurus","Ptilinopus cinctus","Ptilinopus coralensis","Ptilinopus coronulatus","Ptilinopus dupetithouarsii","Ptilinopus eugeniae","Ptilinopus greyii","Ptilinopus huttoni","Ptilinopus hyogastrus","Ptilinopus insularis","Ptilinopus iozonus","Ptilinopus jambu","Ptilinopus layardi","Ptilinopus leclancheri","Ptilinopus luteovirens","Ptilinopus magnificus","Ptilinopus marchei","Ptilinopus melanospilus","Ptilinopus mercierii","Ptilinopus merrilli","Ptilinopus monacha","Ptilinopus nainus","Ptilinopus occipitalis","Ptilinopus ornatus","Ptilinopus pelewensis","Ptilinopus perlatus","Ptilinopus perousii","Ptilinopus porphyraceus","Ptilinopus porphyreus","Ptilinopus pulchellus","Ptilinopus purpuratus","Ptilinopus rarotongensis","Ptilinopus regina","Ptilinopus richardsii","Ptilinopus rivoli","Ptilinopus roseicapilla","Ptilinopus solomonensis","Ptilinopus superbus","Ptilinopus tannensis","Ptilinopus victor","Ptilinopus viridis","Ptilinopus wallacii","Reinwardtoena browni","Reinwardtoena reinwardtii","Scardafella squammata","Streptopelia bitorquata","Streptopelia capicola","Streptopelia chinensis","Streptopelia decaocto","Streptopelia decipiens","Streptopelia hypopyrrha","Streptopelia lugens","Streptopelia orientalis","Streptopelia picturata","Streptopelia risoria","Streptopelia roseogrisea","Streptopelia semitorquata","Streptopelia senegalensis","Streptopelia tranquebarica","Streptopelia turtur","Streptopelia vinacea","Treron apicauda","Treron australis","Treron bicinctus","Treron calvus","Treron curvirostra","Treron formosae","Treron phayrei","Treron phoenicopterus","Treron pompadora","Treron sieboldii","Treron sphenurus","Treron vernans","Treron waalia","Trugon terrestris","Turacoena manadensis","Turtur abyssinicus","Turtur afer","Turtur brehmeri","Turtur chalcospilos","Turtur tympanistria","Uropelia campestris","Zenaida asiatica","Zenaida auriculata","Zenaida aurita","Zenaida galapagoensis","Zenaida graysoni","Zenaida macroura","Zenaida meloda","Zentrygon albifacies","Zentrygon chiriquensis","Zentrygon costaricensis","Zentrygon frenata","Zentrygon goldmani","Zentrygon lawrencii","Anhima cornuta","Caprimulgus vociferus","Chaetura pelagica","Crax blumenbachii","Gallus gallus","Hirundapus caudacutus")

#add to Lapiedra names:
RedP10 <- c("Claravis geoffroyi","Claravis mondetoura","Claravis pretiosa","Columbina buckleyi","Columbina cruziana","Columbina inca","Columbina minuta","Columbina passerina","Columbina picui","Columbina squammata","Columbina talpacoti","Ducula aurorae","Ducula badia","Ducula bakeri","Ducula brenchleyi","Ducula chalconota","Ducula finschii","Ducula forsteni","Ducula galeata","Ducula goliath","Ducula latrans","Ducula mullerii","Ducula myristicivora","Ducula oceanica","Geopelia humeralis","Geopelia placida","Geophaps scripta","Geophaps smithii","Geotrygon chrysia","Macropygia ruficeps","Metriopelia aymara","Metriopelia ceciliae","Metriopelia melanoptera","Metriopelia morenoi","Phapitreron cinereiceps","Phaps elegans","Phaps histrionica","Ptilinopus aurantiifrons","Ptilinopus bernsteinii","Ptilinopus chalcurus","Ptilinopus cinctus","Ptilinopus coralensis","Ptilinopus coronulatus","Ptilinopus dupetithouarsii","Ptilinopus eugeniae","Ptilinopus greyii","Ptilinopus huttoni","Ptilinopus hyogastrus","Ptilinopus insularis","Ptilinopus iozonus","Ptilinopus jambu","Ptilinopus layardi","Ptilinopus marchei","Ptilinopus mercierii","Ptilinopus merrilli","Ptilinopus monacha","Ptilinopus nainus","Ptilinopus ornatus","Ptilinopus pelewensis","Ptilinopus perlatus","Ptilinopus perousii","Ptilinopus porphyraceus","Ptilinopus porphyreus","Ptilinopus purpuratus","Ptilinopus roseicapilla","Ptilinopus tannensis","Ptilinopus viridis","Reinwardtoena reinwardtii","Treron apicauda","Treron bicinctus","Treron curvirostra","Treron formosae","Treron phayrei","Treron phoenicopterus","Treron pompadora","Treron sphenurus","Turtur abyssinicus","Uropelia campestris")
#add to Lapiedra Accession numbers (use to get genetic data in correct order with blanks:
r12S <- "(EF373294 OR EF373296 OR EF373310 OR EF373324)"
CytB <- "(KX169277 OR KJ639093 OR KJ639096 OR KJ639079 OR KJ639084 OR KJ639090 OR KJ639100 OR KJ639102 OR KJ639094 OR KJ639104 OR KJ639088 OR KJ456263 OR KT023369 OR KU194388 OR KU194389 OR KU194391 OR KJ639083 OR KJ639099 OR KJ639085 OR KJ639092 OR KT023379 OR KU194387 OR KT023380 OR KT023381 OR KT023386 OR KT023387 OR KU194392 OR KJ456489 OR KJ456490 OR KJ456491 OR KJ456492 OR KJ456493 OR KJ456494 OR KT023399 OR KJ639098)"
ND2 <- "(KX169278 OR KJ645736 OR KJ645739 OR KJ645722 OR KJ645727 OR KJ645733 OR KJ645743 OR KJ645745 OR KJ645737 OR KJ645747 OR KJ645731 OR KY354865 OR KY354869 OR KY354870 OR KY354891 OR KY354892 OR KY354893 OR KY354896 OR KY354873 OR KY354909 OR KY354899 OR KY354903 OR KY354904 OR KY354906 OR KU194406 OR KU194405 OR KU194408 OR KU194409 OR KC881102 OR KJ645726 OR KJ645742 OR KJ645728 OR KJ645735 OR KT023425 OR KT023426 OR KU194411 OR KF446711 OR KF446756 OR KF446703 OR KF446783 OR KF446702 OR KF446772 OR KF446699 OR KF446686 OR KF446743 OR KF446768 OR KF446774 OR KF446767 OR KF446708 OR KF446730 OR KF446798 OR KF446778 OR KF446766 OR KF446779 OR KF446769 OR KF446776 OR KF446780 OR KF446770 OR KF446709 OR KF446764 OR KF446718 OR KF446706 OR KF446795 OR KF446735 OR KF446752 OR KF446723 OR KJ455675 OR KJ455676 OR KJ455677 OR KJ455678 OR KJ455679 OR KT023455 OR KJ645741)"
COI <- "(KX169279 OR KJ630878 OR KJ630881 OR KJ630864 OR KJ630869 OR KJ630875 OR KJ630885 OR KJ630887 OR KJ630879 OR KJ630889 OR KJ630873 OR KY354911 OR KY354913 OR KY354914 OR KY354918 OR KY354936 OR KU194398 OR KU194397 OR KU194402 OR KU194401 OR KC881104 OR KU194394 OR KJ630868 OR KJ630884 OR KJ630870 OR KJ630877 OR KT023336 OR KT023337 OR KU194396 OR KF446961 OR KF446960 OR KF446957 OR KF446944 OR KF446999 OR KF446966 OR KF446987 OR KF446967 OR KF447006 OR KF446975 OR KF446964 OR KF447015 OR KF446992 OR KF447005 OR KF446980 OR KU194393 OR AB843236 OR JQ176531 OR KT023361 OR KJ630883)"
ATP8 <- "(KX169281 OR KJ630852 OR KJ630855 OR KJ630838 OR KJ630843 OR KJ630849 OR KJ630859 OR KJ630861 OR KJ630853 OR KJ630863 OR KJ630847 OR KJ630858 OR KJ630844 OR KJ630851 OR KJ630842 OR KJ630857)"
FIB7 <- "(KJ668686 OR KJ668689 OR KJ668673 OR KJ668678 OR KJ668683 OR KJ668693 OR KJ668695 OR KJ668687 OR KJ668697 OR KJ668681 OR KC881106 OR KJ668692 OR KJ668679 OR KJ668685 OR KJ668677 OR KJ668691)"
RAG1 <- "(EF373499 OR EF373501 OR KY354840 OR KY354842 OR KY354843 OR KY354846 OR KY354863 OR EF373515 OR KF446885 OR KF446884 OR KF446882 OR KF446878 OR KF446915 OR KF446890 OR KF446904 OR KF446891 OR KF446920 OR KF446896 OR KF446888 OR KF446932 OR KF446907 OR KF446918 OR KF446900 OR KJ456160 OR EF373529)"
IRBP <- "(EF373406 OR EF373408 OR EF373422 OR EF373436)"
